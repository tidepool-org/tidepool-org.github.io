---
layout: defaults
title: Notes V1
published: true
---
# Notes [DRAFT]

Notes represent textual notations that are made to add information to the data stream. They can exist at a specific point in time, or they can refer to an existing item in the data stream. That existing item can also be another note; it is therefore possible to construct a threaded discussion within the data stream.

Note events look like:

~~~json
{
  "type": "note",
  "time": "time_this_message_refers_to",
  "deviceId": "see_common_fields",
  "uploadId": "see_common_fields",
  "shortText": "short_text_of_note",
  "text": "text_of_note",
  "creatorId": "userId of the account that created the note",
  "reference": "event_to_which_this_note_refers",
  "displayTime": "optional_time_to_display_when_rendered"
}
~~~

## Times

Notes can have several different time fields. The standard `time` field is the time that the note should appear in the data stream, and is normally the time displayed when the note is rendered.

If a note references another data item, the note's `time` will be automatically set to equal the `time` of the referenced item. This is so a time-based query will find these records. If the time that should be rendered is different from this time, then the `displayTime` field may be added.

All times are in UTC.

## References

The `reference` field is optional. If present, it can be either the contents of a record to which the note should be attached, or the ID value of a record as retrieved from the database. (See the discussion of the `previous` field in [the bolus reference](../bolus#normal).) The `reference` field can refer to any type of record, including another note.

A threaded discussion should consist of having each note in the thread reference its parent note, with `displayTime` set to the time of each comment in the thread. All of the notes in the discussion will have the same value for the `time` field (because the system enforces that).

## Identity

Notes are always associated with the user whose account they apply to.

Members of someone's care team may also have permission to create notes. In the case where a note is coming from another user, the `creatorId` field should be set to the userId of the account that created the note. Otherwise, `creatorId` should be the ID of the owner of the account.

## Source

If a note is coming from a device that also records other data types, the `source` and `deviceId` should be the same ones used for the other data.

If a note is coming from an independent source such as an add-on app, `source` should identify the software that is doing the upload, and `deviceId` should identify the hardware the information is coming from.

## Text

The text field should be the body of the note. The `shortText` field should be the summary text to be displayed when there's not room to show the whole body (for example, in a tooltip). If `shortText` is not included or is still too long to fit, then `shortText` is ignored and the display will be generated by truncating the text field. This field exists primarily to allow cases where structured notes (say, annotations by a device) may want to control the content of the shorter display.

It is difficult to specify a 'safe' value for the length of shortText without overly constraining the UI designs. However, 20 characters is a reasonable guess.

Note that both the `text` and `shortText` fields will be sanitized / escaped before display, so it is best not to include any attempt at markup. We may someday permit certain kinds of markup (for emphasis, links, etc) but for now this is not allowed.
